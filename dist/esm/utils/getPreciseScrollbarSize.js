import{IS_CHROMIUM}from"./constants.js";import{getStyle}from"./getStyle.js";const SUBPIXEL_OFFSET=new Map;let testStyleElement=null,testParentElement=null,testChildElement=null;function getSubpixelScrollbarSize(t,e){const n=t.split(".");let l=SUBPIXEL_OFFSET.get(n[1]);if(void 0===l){testStyleElement||(testStyleElement=document.createElement("style")),testStyleElement.innerHTML=`\n      #mezr-scrollbar-test::-webkit-scrollbar {\n        width: ${t} !important;\n      }\n    `,testParentElement&&testChildElement||(testParentElement=document.createElement("div"),testChildElement=document.createElement("div"),testParentElement.appendChild(testChildElement),testParentElement.id="mezr-scrollbar-test",testParentElement.style.cssText="\n        all: unset !important;\n        position: fixed !important;\n        top: -200px !important;\n        left: 0px !important;\n        width: 100px !important;\n        height: 100px !important;\n        overflow: scroll !important;\n        pointer-events: none !important;\n        visibility: hidden !important;\n      ",testChildElement.style.cssText="\n        all: unset !important;\n        position: absolute !important;\n        inset: 0 !important;\n      "),document.body.appendChild(testStyleElement),document.body.appendChild(testParentElement);l=testParentElement.getBoundingClientRect().width-testChildElement.getBoundingClientRect().width-e,SUBPIXEL_OFFSET.set(n[1],l),document.body.removeChild(testParentElement),document.body.removeChild(testStyleElement)}return e+l}export function getPreciseScrollbarSize(t,e,n){if(n<=0)return 0;if(IS_CHROMIUM){const n=getStyle(t,"::-webkit-scrollbar"),l="x"===e?n.height:n.width,i=parseFloat(l);if(!Number.isNaN(i)&&!Number.isInteger(i))return getSubpixelScrollbarSize(l,i)}return n}